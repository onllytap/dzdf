-- Variables globales
local Playersaimbot = nil
local PlayersPosition = nil
local mouse = game.Players.LocalPlayer:GetMouse()
local guiservice = game:GetService("GuiService")
local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local currentCamera = game:GetService("Workspace").CurrentCamera
local circle = Drawing.new("Circle")

-- Vérification et nettoyage des GUI précédentes
if game:GetService("CoreGui"):FindFirstChild('infoplayers') then 
    game:GetService("CoreGui"):FindFirstChild('infoplayers'):Destroy()
end

-- Création de l'interface utilisateur
local infoplayers = Instance.new("ScreenGui", game:GetService("CoreGui"))
infoplayers.Name = "infoplayers"
infoplayers.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Main = Instance.new("Frame", infoplayers)
Main.Name = "Main"
Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Main.Position = UDim2.new(0.01, 0, 0.3, 0)
Main.Size = UDim2.new(0, 263, 0, 120)
local MainCorner = Instance.new("UICorner", Main)

-- Profil et informations
local Profile = Instance.new("Frame", Main)
Profile.Name = "Profile"
Profile.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Profile.Position = UDim2.new(0.057, 0, 0.15, 0)
Profile.Size = UDim2.new(0, 60, 0, 60)
local ProfileCorner = Instance.new("UICorner", Profile)
ProfileCorner.CornerRadius = UDim.new(0, 100)

local ImageProfile = Instance.new("ImageLabel", Profile)
ImageProfile.Name = "ImageProfile"
ImageProfile.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ImageProfile.BackgroundTransparency = 0
ImageProfile.Size = UDim2.new(0, 58, 0, 58)
ImageProfile.Position = UDim2.new(0, 1, 0, 1)
local ImageProfileCorner = Instance.new("UICorner", ImageProfile)
ImageProfileCorner.CornerRadius = UDim.new(0, 100)

-- Texte pour le nom et la santé des joueurs
local NamePlayers = Instance.new("TextLabel", Profile)
NamePlayers.Name = "NamePlayers"
NamePlayers.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
NamePlayers.BackgroundTransparency = 1.0
NamePlayers.Position = UDim2.new(1.2, 0, 0, 0)
NamePlayers.Size = UDim2.new(0, 173, 0, 22)
NamePlayers.Font = Enum.Font.FredokaOne
NamePlayers.Text = "Name | N/A"
NamePlayers.TextColor3 = Color3.fromRGB(255, 255, 255)
NamePlayers.TextSize = 19.0
NamePlayers.TextXAlignment = Enum.TextXAlignment.Left

local HealthPlayers = Instance.new("TextLabel", Profile)
HealthPlayers.Name = "HealthPlayers"
HealthPlayers.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
HealthPlayers.BackgroundTransparency = 1.0
HealthPlayers.Position = UDim2.new(1.2, 0, 0.4, 0)
HealthPlayers.Size = UDim2.new(0, 173, 0, 22)
HealthPlayers.Font = Enum.Font.FredokaOne
HealthPlayers.Text = "Health | N/A"
HealthPlayers.TextColor3 = Color3.fromRGB(255, 255, 255)
HealthPlayers.TextSize = 19.0
HealthPlayers.TextXAlignment = Enum.TextXAlignment.Left

-- Barre de santé
local Healthbar = Instance.new("Frame", Profile)
Healthbar.Name = "Healthbar"
Healthbar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Healthbar.Position = UDim2.new(1.2, 0, 0.85, 0)
Healthbar.Size = UDim2.new(0, 155, 0, 8)
local HealthbarCorner = Instance.new("UICorner", Healthbar)

local Healthgreen = Instance.new("Frame", Healthbar)
Healthgreen.Name = "Healthgreen"
Healthgreen.BackgroundColor3 = Color3.fromRGB(0, 227, 110)
Healthgreen.Size = UDim2.new(0, 155, 0, 8)
local HealthgreenCorner = Instance.new("UICorner", Healthgreen)

-- Fonction pour mettre à jour le cercle
function updateCircle(Fov, colorCircle)
    if circle then
        circle.Transparency = 1
        circle.Visible = true
        circle.Thickness = 2
        circle.Color = colorCircle
        circle.NumSides = 100
        circle.Radius = (Fov * 6) / 2
        circle.Filled = false
        circle.Position = Vector2.new(mouse.X, mouse.Y + guiservice:GetGuiInset().Y)
    end
end

-- Fonction principale de détection des joueurs
spawn(function()
    while wait() do
        for _, player in ipairs(players:GetPlayers()) do
            local character = workspace:FindFirstChild(player.Name)
            if character and character:FindFirstChild("HumanoidRootPart") then
                local hrp = character.HumanoidRootPart
                local pos = currentCamera:WorldToViewportPoint(hrp.Position)
                local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(mouse.X, mouse.Y)).Magnitude
                if magnitude < ((getgenv().setting['Fov'] * 6 - 8) / 2) then
                    if magnitude < math.huge then
                        if (hrp.Position - localPlayer.Character.HumanoidRootPart.Position).magnitude <= 1000 then
                            if player.Name ~= localPlayer.Name then
                                if not getgenv().setting['LockPlayers'] then
                                    Playersaimbot = player.Name
                                    PlayersPosition = hrp.Position
                                    hrp.Size = Vector3.new(2, 2, 2) -- Réduction de la taille des hitbox
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- Suivi en temps réel pour les informations de santé
spawn(function()
    game:GetService("RunService").RenderStepped:Connect(function()
        if Playersaimbot then
            for _, player in ipairs(players:GetPlayers()) do
                if player.Name == Playersaimbot then
                    local character = workspace:FindFirstChild(player.Name)
                    if character and character:FindFirstChild("Humanoid") then
                        local humanoid = character.Humanoid
                        NamePlayers.Text = "Name | " .. player.Name
                        HealthPlayers.Text = "Health | " .. math.floor(humanoid.Health) .. "/" .. humanoid.MaxHealth
                        local hp = humanoid.Health / humanoid.MaxHealth
                        Healthgreen:TweenSize(UDim2.new(hp, 0, 1, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.15)
                        ImageProfile.Image = players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
                    end
                end
            end
        end
    end)
end)

-- Ajout d'une logique de verrouillage
game:GetService("UserInputService").InputBegan:Connect(function(io)
    if io.KeyCode == Enum.KeyCode.E then
        getgenv().setting['LockPlayers'] = not getgenv().setting['LockPlayers']
    end
end)

-- Amélioration de la logique des attaques automatiques
mouse.Button1Down:Connect(function()
    if Playersaimbot then
        local target = players:FindFirstChild(Playersaimbot)
        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = target.Character.HumanoidRootPart
            local args = {hrp.Position, hrp}
            local tool = localPlayer.Character:FindFirstChildOfClass("Tool")
            if tool and tool:FindFirstChild("RemoteFunctionShoot") then
                tool.RemoteFunctionShoot:InvokeServer(unpack(args))
            end
        end
    end
end)
